import os
import re
from telegram import Update
from telegram.ext import Application, MessageHandler, ContextTypes, filters

BOT_TOKEN = os.getenv("BOT_TOKEN", "5788330295:AAHhDVCjGt6g2vBrCuyAKK5Zjj3o73s7yTg")
ADMIN_ID = int(os.getenv("ADMIN_ID", "988757303"))

# Ø¯Ø§Ù„Ø© ØªØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
def extract_url(text):
    url_pattern = r'(https?://[^\s]+)'
    match = re.search(url_pattern, text)
    return match.group(0) if match else None

# Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø±Ø§Ø¨Ø·
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message_text = update.message.text
    url = extract_url(message_text)

    if url:
        await update.message.reply_text(f"ğŸ“¥ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø·:\n{url}\nØ¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...")
        # Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø± ØªØ¶ÙŠÙ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø·
        await context.bot.send_message(chat_id=ADMIN_ID, text=f"ğŸ”— Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯ Ù…Ù† @{update.effective_user.username or 'Ù…Ø³ØªØ®Ø¯Ù…'}:\n{url}")
    else:
        await update.message.reply_text("ğŸ“Œ Ø£Ø±Ø³Ù„ Ø±Ø§Ø¨Ø· ÙˆØ³ÙŠØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.")

def main():
    application = Application.builder().token(BOT_TOKEN).build()
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    application.run_polling()

if __name__ == "__main__":
    main()
